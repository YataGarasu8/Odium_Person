using System.Collections;
using System.Collections.Generic;
using TMPro;
using UnityEngine;
using UnityEngine.UI;

public class InventoryUI : MonoBehaviour
{
    public List<ItemSlot> slots;

    public GameObject itemSlots;
    public GameObject inventoryWindow;

    [Header("Select Item")]
    private ItemSlot selectItem;
    private int selectItemIndex;
    public int maxSlotcount;
    public TextMeshProUGUI slotCountText;
    public TextMeshProUGUI ItemNameText;
    public TextMeshProUGUI ItemStatusText;
    public TextMeshProUGUI ItemExplainText;
    public Transform Content;

    public bool IsOpen()
    {
        return inventoryWindow.activeInHierarchy;//창이 켜져있는지 여부
    }
    public void Toggle()//창 켰다 끄기
    {
        if (IsOpen())
        {
            inventoryWindow.SetActive(false);
        }
        else
        {
            inventoryWindow.SetActive(true);
        }
    }
    public void UpdateUI()
    {
        for (int i = 0; i < slots.Count; i++)
        {
            if (slots[i].itemDate != null)
            {
                slots[i].Set();
            }
            else
            {
                slots[i].Clear();
            }
        }
        slotCountText.text = $"{slots.Count}/{maxSlotcount}";
    }
    public void AddItem(ItemDate date)//아이템 추가
    {
        if (date.canStack)//중복이 가능한 아이템일 경우
        {
            ItemSlot slot = GetStackItemSlot(date);//같은 종류의 아이템을 검색

            if (slot != null)//같은 종류의 아이템이 있을 경우(null로 반환되지 않았다면)
            {
                slot.quantity++;
                UpdateUI();
                return;
            }
        }
        if (slots.Count < maxSlotcount)//인벤토리 보유 상한을 넘지 않을 경우
        {
            GameObject itemSlot = Instantiate(itemSlots, Content);
            itemSlot.GetComponent<ItemSlot>().itemDate = date;
            slots.Add(itemSlot.GetComponent<ItemSlot>()); // 리스트에 추가
            UpdateUI();
            return;
        }

    }
    public void SelectItem(ItemDate date)
    {
        if (date != null)
        {
            ItemNameText.text = date.itemName;
            ItemExplainText.text = date.itemDescription;
        }
    }
    ItemSlot GetStackItemSlot(ItemDate date)//같은 종류의 아이템을 검색
    {
        for (int i = 0; i < slots.Count; i++)
        {
            if (slots[i].itemDate == date && slots[i].quantity < date.maxStackAmount)
            {
                return slots[i];
            }
        }
        return null;
    }
}
